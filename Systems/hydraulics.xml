<?xml version="1.0" encoding="utf-8"?>

<PropertyList>

    <!-- EMERGENCY BRAKE LOAD -->
    <filter>
        <type>derivative</type>
        <filter-time>10</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/left-brake-input-emer</property>
        </input>
        <output>systems/hydraulic/left-emergency-brake-load</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>
    <filter>
        <type>derivative</type>
        <filter-time>10</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/right-brake-input-emer</property>
        </input>
        <output>systems/hydraulic/right-emergency-brake-load</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>

    <!-- SINKS -->
    <filter>
        <name>Nosewheel Steering</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>/fdm/jsbsim/fcs/steer-pos-deg[0]</input>
        <output>systems/hydraulic/system[1]/sinks/nosewheel-steering</output>
    </filter>

    <filter>
        <name>Reverser Left</name>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>/engines/engine[0]/reverser-pos-norm</input>
        <output>systems/hydraulic/system[0]/sinks/thrust-reverser-left</output>
    </filter>
    <filter>
        <name>Reverser Right</name>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>/engines/engine[1]/reverser-pos-norm</input>
        <output>systems/hydraulic/system[1]/sinks/thrust-reverser-right</output>
    </filter>

    <filter>
        <name>Rudder Demand</name>
        <type>derivative</type>
        <filter-time>0.015</filter-time>
        <input>fdm/jsbsim/fcs/rudder-master</input>
        <output>systems/hydraulic/rudder-demand</output>
    </filter>

    <filter>
        <name>Elevator Demand LH</name>
        <type>derivative</type>
        <filter-time>0.015</filter-time>
        <input>fdm/jsbsim/fcs/elevator-lh-master</input>
        <output>systems/hydraulic/elevator-lh-demand</output>
    </filter>
    <filter>
        <name>Elevator Demand RH</name>
        <type>derivative</type>
        <filter-time>0.015</filter-time>
        <input>fdm/jsbsim/fcs/elevator-rh-master</input>
        <output>systems/hydraulic/elevator-rh-demand</output>
    </filter>

    <filter>
        <name>Aileron Demand LH</name>
        <type>derivative</type>
        <filter-time>0.015</filter-time>
        <input>fdm/jsbsim/fcs/left-aileron-master</input>
        <output>systems/hydraulic/left-aileron-demand</output>
    </filter>
    <filter>
        <name>Aileron Demand RH</name>
        <type>derivative</type>
        <filter-time>0.015</filter-time>
        <input>fdm/jsbsim/fcs/right-aileron-master</input>
        <output>systems/hydraulic/right-aileron-demand</output>
    </filter>

    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/rudder/pcu[0]/active</property>
            </condition>
            <property>systems/hydraulic/rudder-demand</property>
        </input>
        <output>systems/hydraulic/system[0]/sinks/rudder-upper</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/rudder/pcu[1]/active</property>
            </condition>
            <property>systems/hydraulic/rudder-demand</property>
        </input>
        <output>systems/hydraulic/system[2]/sinks/rudder-lower</output>
    </filter>

    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/elevator/pcu[0]/active</property>
            </condition>
            <property>systems/hydraulic/elevator-lh-demand</property>
        </input>
        <output>systems/hydraulic/system[0]/sinks/elevator-left-outboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/elevator/pcu[1]/active</property>
            </condition>
            <property>systems/hydraulic/elevator-lh-demand</property>
        </input>
        <output>systems/hydraulic/system[1]/sinks/elevator-left-inboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/elevator/pcu[2]/active</property>
            </condition>
            <property>systems/hydraulic/elevator-rh-demand</property>
        </input>
        <output>systems/hydraulic/system[1]/sinks/elevator-right-inboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <property>systems/actuators/elevator/pcu[3]/active</property>
            </condition>
            <property>systems/hydraulic/elevator-rh-demand</property>
        </input>
        <output>systems/hydraulic/system[2]/sinks/elevator-right-outboard</output>
    </filter>

    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <and>
                    <property>systems/actuators/aileron/pcu[0]/active</property>
                    <property>systems/actuators/aileron/pcu[1]/active</property>
                </and>
            </condition>
            <expression>
                <product>
                    <property>systems/hydraulic/left-aileron-demand</property>
                    <value>0.5</value>
                </product>
            </expression>
        </input>
        <input>
            <condition>
                <property>systems/actuators/aileron/pcu[0]/active</property>
            </condition>
            <property>systems/hydraulic/left-aileron-demand</property>
        </input>
        <input><value>0</value></input>
        <output>systems/hydraulic/system[2]/sinks/aileron-left-outboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <and>
                    <property>systems/actuators/aileron/pcu[0]/active</property>
                    <property>systems/actuators/aileron/pcu[1]/active</property>
                </and>
            </condition>
            <expression>
                <product>
                    <property>systems/hydraulic/left-aileron-demand</property>
                    <value>0.5</value>
                </product>
            </expression>
        </input>
        <input>
            <condition>
                <property>systems/actuators/aileron/pcu[1]/active</property>
            </condition>
            <property>systems/hydraulic/left-aileron-demand</property>
        </input>
        <input><value>0</value></input>
        <output>systems/hydraulic/system[1]/sinks/aileron-left-inboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <and>
                    <property>systems/actuators/aileron/pcu[2]/active</property>
                    <property>systems/actuators/aileron/pcu[3]/active</property>
                </and>
            </condition>
            <expression>
                <product>
                    <property>systems/hydraulic/right-aileron-demand</property>
                    <value>0.5</value>
                </product>
            </expression>
        </input>
        <input>
            <condition>
                <property>systems/actuators/aileron/pcu[3]/active</property>
            </condition>
            <property>systems/hydraulic/right-aileron-demand</property>
        </input>
        <input><value>0</value></input>
        <output>systems/hydraulic/system[2]/sinks/aileron-right-outboard</output>
    </filter>
    <filter>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <and>
                    <property>systems/actuators/aileron/pcu[2]/active</property>
                    <property>systems/actuators/aileron/pcu[3]/active</property>
                </and>
            </condition>
            <expression>
                <product>
                    <property>systems/hydraulic/right-aileron-demand</property>
                    <value>0.5</value>
                </product>
            </expression>
        </input>
        <input>
            <condition>
                <property>systems/actuators/aileron/pcu[2]/active</property>
            </condition>
            <property>systems/hydraulic/right-aileron-demand</property>
        </input>
        <input><value>0</value></input>
        <output>systems/hydraulic/system[1]/sinks/aileron-right-inboard</output>
    </filter>

    <filter>
        <name>MFS1</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs1-powered</input>
        <output>systems/hydraulic/system[1]/sinks/mfs1</output>
    </filter>
    <filter>
        <name>MFS2</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs2-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs2</output>
    </filter>
    <filter>
        <name>MFS3</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs3-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs3</output>
    </filter>
    <filter>
        <name>MFS4</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs4-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs4</output>
    </filter>
    <filter>
        <name>MFS5</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs5-powered</input>
        <output>systems/hydraulic/system[1]/sinks/mfs5</output>
    </filter>
    <filter>
        <name>MFS6</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs6-powered</input>
        <output>systems/hydraulic/system[1]/sinks/mfs6</output>
    </filter>
    <filter>
        <name>MFS7</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs7-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs7</output>
    </filter>
    <filter>
        <name>MFS8</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs8-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs8</output>
    </filter>
    <filter>
        <name>MFS9</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs9-powered</input>
        <output>systems/hydraulic/system[0]/sinks/mfs9</output>
    </filter>
    <filter>
        <name>MFS10</name>
        <type>derivative</type>
        <filter-time>0.01</filter-time>
        <input>fdm/jsbsim/fcs/mfs10-powered</input>
        <output>systems/hydraulic/system[1]/sinks/mfs10</output>
    </filter>

    <filter>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/left-inboard-brake-input-norm</property>
        </input>
        <output>systems/hydraulic/system[1]/sinks/brake-left-inboard</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>
    <filter>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/right-inboard-brake-input-norm</property>
        </input>
        <output>systems/hydraulic/system[1]/sinks/brake-right-inboard</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>
    <filter>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/left-outboard-brake-input-norm</property>
        </input>
        <output>systems/hydraulic/system[0]/sinks/brake-left-outboard</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>
    <filter>
        <type>derivative</type>
        <filter-time>1</filter-time>
        <input>
            <property>fdm/jsbsim/fcs/right-outboard-brake-input-norm</property>
        </input>
        <output>systems/hydraulic/system[0]/sinks/brake-right-outboard</output>
        <u_min>0.0</u_min>
        <u_max>10000.0</u_max>
    </filter>

    <!-- HYDRAULIC SYSTEM 1 -->
    <filter>
        <name>Accumulator level 1</name>
        <type>integrator</type>
        <gain>0.1</gain>
        <input>
            <expression>
                <difference>
                    <sum>
                        <property>systems/hydraulic/system[0]/edp/power</property>
                        <property>systems/hydraulic/system[0]/ehp/power</property>
                    </sum>
                    <sum>
                        <property>systems/hydraulic/system[0]/demand</property>
                        <value>0.001</value>
                    </sum>
                </difference>
            </expression>
        </input>
        <output>systems/hydraulic/system[0]/accumulator</output>
        <initialize-to>output</initialize-to>
        <u_min>0.0</u_min>
        <u_max>1.0</u_max>
    </filter>

    <filter>
        <name>Emergency Accumulator level 1</name>
        <type>integrator</type>
        <gain>0.01</gain>
        <input>
            <expression>
                <difference>
                    <sum>
                        <product>
                            <property>systems/hydraulic/system[0]/pressure-psi</property>
                            <value>0.001666667</value>
                        </product>
                    </sum>
                    <sum>
                        <property>systems/hydraulic/left-emergency-brake-load</property>
                        <property>systems/hydraulic/right-emergency-brake-load</property>
                    </sum>
                </difference>
            </expression>
        </input>
        <output>systems/hydraulic/system[0]/emergency-accumulator</output>
        <initialize-to>output</initialize-to>
        <u_min>0.0</u_min>
        <u_max>1.0</u_max>
    </filter>

    <logic>
        <name>System 1 Pressurized</name>
        <input>
            <greater-than>
                <property>systems/hydraulic/system[0]/pressure-psi</property>
                <value>1500</value>
            </greater-than>
        </input>
        <output>systems/hydraulic/system[0]/pressurized</output>
    </logic>

    <flipflop>
        <type>RS</type>
        <name>Accumulator 1 Low</name>
        <S>
            <less-than>
                <property>systems/hydraulic/system[0]/accumulator</property>
                <value>0.90</value>
            </less-than>
        </S>
        <R>
            <greater-than>
                <property>systems/hydraulic/system[0]/accumulator</property>
                <value>0.9999</value>
            </greater-than>
        </R>
        <output>systems/hydraulic/system[0]/accumulator-low</output>
    </flipflop>

    <logic>
        <name>EDP 1 engage logic</name>
        <input>
            <and>
                <not>
                    <property>controls/hydraulic/edp-shutoff[0]</property>
                </not>
                <greater-than>
                    <property>engines/engine[0]/n1</property>
                    <value>18</value>
                </greater-than>
            </and>
        </input>
        <output>systems/hydraulic/system[0]/edp/engaged</output>
    </logic>
    <logic>
        <name>EHP 1 engage logic</name>
        <input>
            <and>
                <or>
                    <and>
                        <equals>
                            <property>controls/hydraulic/ehp[0]</property>
                            <value>0</value>
                        </equals>
                        <less-than>
                            <property>systems/hydraulic/system[0]/edp/power</property>
                            <value>0.9</value>
                        </less-than>
                        <property>systems/hydraulic/system[0]/accumulator-low</property>
                    </and>
                    <equals>
                        <property>controls/hydraulic/ehp[0]</property>
                        <value>1</value>
                    </equals>
                </or>
            </and>
        </input>
        <output>systems/hydraulic/system[0]/ehp/engaged</output>
    </logic>

    <filter>
        <name>EDP 1</name>
        <type>gain</type>
        <gain>0.15</gain>
        <input>
            <condition>
                <property>systems/hydraulic/system[0]/edp/engaged</property>
            </condition>
            <expression>
                <difference>
                    <property>engines/engine[0]/n1</property>
                    <value>18</value>
                </difference>
            </expression>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[0]/edp/power</output>
    </filter>

    <filter>
        <name>EHP 1</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <greater-than>
                    <property>systems/electrical/outputs/ehp[0]</property>
                    <value>20</value>
                </greater-than>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[0]/ehp/power</output>
    </filter>

    <filter>
        <name>Demand 1</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <sum>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/elevator-left-outboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/rudder-upper</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/thrust-reverser-left</property>
                    </abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs2</property></abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs3</property></abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs4</property></abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs7</property></abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs8</property></abs>
                    <abs><property>systems/hydraulic/system[0]/sinks/mfs9</property></abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/brake-left-outboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/brake-right-outboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/parking-brake</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[0]/sinks/ptu</property>
                    </abs>
                </sum>
            </expression>
        </input>
        <output>systems/hydraulic/system[0]/demand</output>
    </filter>

    <filter>
        <name>PTU draw</name>
        <type>gain</type>
        <gain>1</gain>
        <input>systems/hydraulic/system[1]/ptu/power</input>
        <output>systems/hydraulic/system[0]/sinks/ptu</output>
    </filter>

    <filter>
        <name>Pressure 1</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <table>
                    <property>systems/hydraulic/system[0]/accumulator</property>
                    <entry>
                        <ind>0</ind><dep>0</dep>
                    </entry>
                    <entry>
                        <ind>0.5</ind><dep>3000</dep>
                    </entry>
                    <entry>
                        <ind>1.0</ind><dep>3000</dep>
                    </entry>
                </table>
            </expression>
        </input>
        <output>systems/hydraulic/system[0]/pressure-psi</output>
    </filter>

    <!-- HYDRAULIC SYSTEM 2 -->
    <filter>
        <name>Accumulator level 2</name>
        <type>integrator</type>
        <gain>0.1</gain>
        <input>
            <expression>
                <difference>
                    <sum>
                        <property>systems/hydraulic/system[1]/edp/power</property>
                        <property>systems/hydraulic/system[1]/ehp/power</property>
                        <property>systems/hydraulic/system[1]/ptu/power</property>
                    </sum>
                    <sum>
                        <property>systems/hydraulic/system[1]/demand</property>
                        <value>0.001</value>
                    </sum>
                </difference>
            </expression>
        </input>
        <output>systems/hydraulic/system[1]/accumulator</output>
        <initialize-to>output</initialize-to>
        <u_min>0.0</u_min>
        <u_max>1.0</u_max>
    </filter>

    <filter>
        <name>Emergency Accumulator level 2</name>
        <type>integrator</type>
        <gain>0.01</gain>
        <input>
            <expression>
                <difference>
                    <sum>
                        <product>
                            <property>systems/hydraulic/system[1]/pressure-psi</property>
                            <value>0.001666667</value>
                        </product>
                    </sum>
                    <sum>
                        <property>systems/hydraulic/left-emergency-brake-load</property>
                        <property>systems/hydraulic/right-emergency-brake-load</property>
                    </sum>
                </difference>
            </expression>
        </input>
        <output>systems/hydraulic/system[1]/emergency-accumulator</output>
        <initialize-to>output</initialize-to>
        <u_min>0.0</u_min>
        <u_max>1.0</u_max>
    </filter>


    <logic>
        <name>System 2 Pressurized</name>
        <input>
            <greater-than>
                <property>systems/hydraulic/system[1]/pressure-psi</property>
                <value>1500</value>
            </greater-than>
        </input>
        <output>systems/hydraulic/system[1]/pressurized</output>
    </logic>

    <flipflop>
        <type>RS</type>
        <name>Accumulator 2 Low</name>
        <S>
            <less-than>
                <property>systems/hydraulic/system[1]/accumulator</property>
                <value>0.90</value>
            </less-than>
        </S>
        <R>
            <greater-than>
                <property>systems/hydraulic/system[1]/accumulator</property>
                <value>0.9999</value>
            </greater-than>
        </R>
        <output>systems/hydraulic/system[1]/accumulator-low</output>
    </flipflop>

    <logic>
        <name>EDP 2 engage logic</name>
        <input>
            <and>
                <not>
                    <property>controls/hydraulic/edp-shutoff[1]</property>
                </not>
                <greater-than>
                    <property>engines/engine[1]/n1</property>
                    <value>18</value>
                </greater-than>
            </and>
        </input>
        <output>systems/hydraulic/system[1]/edp/engaged</output>
    </logic>
    <logic>
        <name>EHP 2 engage logic</name>
        <input>
            <and>
                <or>
                    <and>
                        <equals>
                            <property>controls/hydraulic/ehp[1]</property>
                            <value>0</value>
                        </equals>
                        <less-than>
                            <property>systems/hydraulic/system[1]/edp/power</property>
                            <value>0.9</value>
                        </less-than>
                        <property>systems/hydraulic/system[1]/accumulator-low</property>
                    </and>
                    <equals>
                        <property>controls/hydraulic/ehp[1]</property>
                        <value>1</value>
                    </equals>
                </or>
            </and>
        </input>
        <output>systems/hydraulic/system[1]/ehp/engaged</output>
    </logic>
    <logic>
        <name>PTU engage logic</name>
        <input>
            <and>
                <or>
                    <and>
                        <equals>
                            <property>controls/hydraulic/ptu</property>
                            <value>0</value>
                        </equals>
                        <property>systems/hydraulic/system[1]/accumulator-low</property>
                    </and>
                    <equals>
                        <property>controls/hydraulic/ptu</property>
                        <value>1</value>
                    </equals>
                </or>
                <greater-than>
                    <property>systems/hydraulic/system[1]/fill-ratio</property>
                    <value>0.12</value>
                </greater-than>
                <property>systems/hydraulic/system[0]/pressurized</property>
                <not>
                    <property>systems/hydraulic/system[1]/edp/power</property>
                </not>
                <not>
                    <and>
                        <greater-than>
                            <property>controls/hydraulic/ehp[1]</property>
                            <value>-1</value>
                        </greater-than>
                        <greater-than>
                            <property>systems/electrical/outputs/ehp[1]</property>
                            <value>20</value>
                        </greater-than>
                    </and>
                </not>
            </and>
        </input>
        <output>systems/hydraulic/system[1]/ptu/engaged</output>
    </logic>

    <filter>
        <name>EDP 2</name>
        <type>gain</type>
        <gain>0.15</gain>
        <input>
            <condition>
                <property>systems/hydraulic/system[1]/edp/engaged</property>
            </condition>
            <expression>
                <difference>
                    <property>engines/engine[1]/n1</property>
                    <value>18</value>
                </difference>
            </expression>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[1]/edp/power</output>
    </filter>

    <filter>
        <name>PTU</name>
        <type>gain</type>
        <gain>0.005</gain>
        <input>
            <condition>
                <property>systems/hydraulic/system[1]/ptu/engaged</property>
            </condition>
            <property>systems/hydraulic/system[0]/pressure-psi</property>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[1]/ptu/power</output>
    </filter>

    <filter>
        <name>EHP 2</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <greater-than>
                    <property>systems/electrical/outputs/ehp[1]</property>
                    <value>20</value>
                </greater-than>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[1]/ehp/power</output>
    </filter>

    <filter>
        <name>Demand 2</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <sum>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/elevator-left-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/elevator-right-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/aileron-left-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/aileron-right-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/thrust-reverser-right</property>
                    </abs>
                    <abs><property>systems/hydraulic/system[1]/sinks/mfs1</property></abs>
                    <abs><property>systems/hydraulic/system[1]/sinks/mfs5</property></abs>
                    <abs><property>systems/hydraulic/system[1]/sinks/mfs6</property></abs>
                    <abs><property>systems/hydraulic/system[1]/sinks/mfs10</property></abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/brake-left-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/brake-right-inboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/nosewheel-steering</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/landing-gear</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[1]/sinks/parking-brake</property>
                    </abs>
                </sum>
            </expression>
        </input>
        <output>systems/hydraulic/system[1]/demand</output>
    </filter>

    <filter>
        <name>Pressure 2</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <table>
                    <property>systems/hydraulic/system[1]/accumulator</property>
                    <entry>
                        <ind>0</ind><dep>0</dep>
                    </entry>
                    <entry>
                        <ind>0.5</ind><dep>3000</dep>
                    </entry>
                    <entry>
                        <ind>1.0</ind><dep>3000</dep>
                    </entry>
                </table>
            </expression>
        </input>
        <output>systems/hydraulic/system[1]/pressure-psi</output>
    </filter>

    <!-- HYDRAULIC SYSTEM 3 -->
    <filter>
        <name>Accumulator level 3</name>
        <type>integrator</type>
        <gain>0.1</gain>
        <input>
            <expression>
                <difference>
                    <sum>
                        <property>systems/hydraulic/system[2]/ehp[0]/power</property>
                        <property>systems/hydraulic/system[2]/ehp[1]/power</property>
                    </sum>
                    <sum>
                        <property>systems/hydraulic/system[2]/demand</property>
                        <value>0.001</value>
                    </sum>
                </difference>
            </expression>
        </input>
        <output>systems/hydraulic/system[2]/accumulator</output>
        <initialize-to>output</initialize-to>
        <u_min>0.0</u_min>
        <u_max>1.0</u_max>
    </filter>

    <logic>
        <name>System 3 Pressurized</name>
        <input>
            <greater-than>
                <property>systems/hydraulic/system[2]/pressure-psi</property>
                <value>1500</value>
            </greater-than>
        </input>
        <output>systems/hydraulic/system[2]/pressurized</output>
    </logic>

    <flipflop>
        <type>RS</type>
        <name>Accumulator 3 Low</name>
        <S>
            <less-than>
                <property>systems/hydraulic/system[2]/accumulator</property>
                <value>0.90</value>
            </less-than>
        </S>
        <R>
            <greater-than>
                <property>systems/hydraulic/system[2]/accumulator</property>
                <value>0.9999</value>
            </greater-than>
        </R>
        <output>systems/hydraulic/system[2]/accumulator-low</output>
    </flipflop>

    <logic>
        <name>EHP 3A engage logic</name>
        <input>
            <and>
                <or>
                    <equals>
                        <property>controls/hydraulic/ehp[2]</property>
                        <value>0</value>
                    </equals>
                    <equals>
                        <property>controls/hydraulic/ehp[2]</property>
                        <value>1</value>
                    </equals>
                </or>
            </and>
        </input>
        <output>systems/hydraulic/system[2]/ehp[0]/engaged</output>
    </logic>
    <logic>
        <name>EHP 3B engage logic</name>
        <input>
            <or>
                <and>
                    <equals>
                        <property>controls/hydraulic/ehp[3]</property>
                        <value>0</value>
                    </equals>
                    <property>systems/hydraulic/system[2]/accumulator-low</property>
                    <less-than>
                        <property>systems/hydraulic/system[2]/ehp[0]/power</property>
                        <value>0.9</value>
                    </less-than>
                </and>
                <equals>
                    <property>controls/hydraulic/ehp[3]</property>
                    <value>1</value>
                </equals>
            </or>
        </input>
        <output>systems/hydraulic/system[2]/ehp[1]/engaged</output>
    </logic>


    <filter>
        <name>EHP 3A</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <greater-than>
                    <property>systems/electrical/outputs/ehp[2]</property>
                    <value>20</value>
                </greater-than>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[2]/ehp[0]/power</output>
    </filter>
    <filter>
        <name>EHP 3B</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <condition>
                <greater-than>
                    <property>systems/electrical/outputs/ehp[3]</property>
                    <value>20</value>
                </greater-than>
            </condition>
            <value>1</value>
        </input>
        <input>
            <value>0</value>
        </input>
        <min>0</min>
        <max>1</max>
        <output>systems/hydraulic/system[2]/ehp[1]/power</output>
    </filter>

    <filter>
        <name>Demand 3</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <sum>
                    <abs>
                        <property>systems/hydraulic/system[2]/sinks/elevator-right-outboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[2]/sinks/rudder-lower</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[2]/sinks/aileron-left-outboard</property>
                    </abs>
                    <abs>
                        <property>systems/hydraulic/system[2]/sinks/aileron-right-outboard</property>
                    </abs>
                </sum>
            </expression>
        </input>
        <output>systems/hydraulic/system[2]/demand</output>
    </filter>

    <filter>
        <name>Pressure 3</name>
        <type>gain</type>
        <gain>1</gain>
        <input>
            <expression>
                <table>
                    <property>systems/hydraulic/system[2]/accumulator</property>
                    <entry>
                        <ind>0</ind><dep>0</dep>
                    </entry>
                    <entry>
                        <ind>0.5</ind><dep>3000</dep>
                    </entry>
                    <entry>
                        <ind>1.0</ind><dep>3000</dep>
                    </entry>
                </table>
            </expression>
        </input>
        <output>systems/hydraulic/system[2]/pressure-psi</output>
    </filter>
</PropertyList>
